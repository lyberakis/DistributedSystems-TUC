{"ast":null,"code":"import openSocket from'socket.io-client';import Bishop from'../pieces/bishop.js';import Knight from'../pieces/knight.js';import Queen from'../pieces/queen.js';import Rook from'../pieces/rook.js';import King from'../pieces/king.js';import Pawn from'../pieces/pawn.js';// ==========================================\n// ==> Variables in state <==\n//==> host: The domain of the host (localhost)\n//==> gamemaster: the port of gamemaster for client requests\n//==> token: the unique token of the user issued from the Authorization Service\n//==> socket: the socket objet of the client connected to the server\n//==> type: the symbol of the user (X,O or white, black)\n//==> roundID: the ID of the game\n//==> connectionStatus: Connection Status\n// -3 => unauthorized user\n// -2 => trying to reconnect\n// -1 => no connection (the client has not connect to the giver Playmaster)\n//  0 => connected\n//  1 => wait opponent to connect\n//  2 => ready to play\n//  3 => the game is completed\n//  4 => winner because opponent left\n//  5 => spectator mode\n// ==========================================\n// ==> Messages from client to playmaster <==\n// 1. Send the new board \n// let message = {\n//   roundID : this.state.roundID,\n//   board : squares\n// }\n// this.state.socket.emit('update', message)\n// 2. Inform the playmaster for the winner, if you are the last to play\n// let message = {\n//   roundID : this.state.roundID,\n//   winner: winnerInfo,  //0 for tie, 1 if you won, -1 if you lost\n// }\n// this.state.socket.emit('endgame', message)\n// ==========================================\n// ===> FOR OTHER GAME CHANGE THE LINE 109 and 133-140\n// ==========================================\n//Get argument from the URL\nexport function getArgumenets(){var url_string=window.location['href'];var url=new URL(url_string);var host=url.hostname;var playmaster=url.searchParams.get(\"pm\");var gamemaster=url.searchParams.get(\"gm\");var token=url.searchParams.get(\"token\");var args={'host':host,'token':token,'playmaster':playmaster,'gamemaster':gamemaster};return args;}//Connect to Playmaster\nexport function connect(server,token){var handShake={query:'token='+token};var socket=openSocket(server,handShake);var response={'socket':socket,'connectionStatus':socket['connected']?0:-1};return response;}export function setListeners(obj){//You connected first, wait for the opponent to connect\nobj.state.socket.on('wait',function(message){obj.setState({connectionStatus:1,roundID:message['roundID']});});//Both players are connected. The game can begin\nobj.state.socket.on('init',function(message){//Check if the game is new or it is continued from server fault.\nif(obj.state.type===null){obj.setState({connectionStatus:2,myTurn:message['turn'],roundID:message['roundID'],myColor:message['turn']?'white':'black'});}else{obj.setState({connectionStatus:2,roundID:message['roundID']//get the new round ID\n});}});//Both players are connected. The game can begin\nobj.state.socket.on('viewer',function(board){console.log('VIWER');var classes=stringsToClasses(board);obj.setState({connectionStatus:5,squares:classes,myTurn:false});});//Receive the updated board\nobj.state.socket.on('board',function(board){var classes=stringsToClasses(board[\"board\"]);var whiteFallenSoldiers=stringsToClasses(board[\"whiteFallenSoldiers\"]);var blackFallenSoldiers=stringsToClasses(board[\"blackFallenSoldiers\"]);var turn,player;if(!board['dontChange']){turn=obj.state.turn==='white'?'black':'white';player=obj.state.player===1?2:1;}else{turn=obj.state.turn;player=obj.state.player;}console.log(board[\"board\"]);console.log(classes);obj.setState({squares:classes,turn:turn,whiteFallenSoldiers:whiteFallenSoldiers,blackFallenSoldiers:blackFallenSoldiers,status:board['status'],kingStatus:board['kingStatus'],player:player,myTurn:true});//Set Game progress\nif(board['progress']===1){obj.setState({connectionStatus:3,endstate:1});}else if(board['progress']===2){obj.setState({connectionStatus:3,endstate:2});}});//Handler for server disconnection\nobj.state.socket.on('disconnect',function(board){//if you never connected or the game is completed, return\nif(obj.state.connectionStatus<0||obj.state.connectionStatus>2){return;}obj.state.socket.disconnect();obj.setState({connectionStatus:-2});//Create a request to GameMaster\nvar xhr=new XMLHttpRequest();xhr.onload=function(e){if(xhr.readyState===4){//Check if the GameMaster accepted the request\nif(xhr.connectionStatus===200){var respone=JSON.parse(xhr.responseText);reconnect(obj,respone['playmaster']);}else if(xhr.connectionStatus===403){obj.setState({connectionStatus:-3,endstate:1});}}};var game='chess';var master=obj.state.host+':'+obj.state.gamemaster+'/client';var url='http://'+master+'?'+'token='+obj.state.token+'&game='+game+'&roundID='+obj.state.roundID;var delay=function delay(ms,cb){return setTimeout(cb,ms);};delay(getRndInteger(1,300)*100,function(){xhr.open('GET',url);xhr.setRequestHeader('Access-Control-Allow-Origin','*');xhr.send();});});//The game is over from the server's side\nobj.state.socket.on('endgame',function(message){obj.setState({connectionStatus:4});obj.state.socket.disconnect();});}function getRndInteger(min,max){return Math.floor(Math.random()*(max-min+1))+min;}//Establish a new connections\nexport function reconnect(obj,port){console.log('reconnecting...');var playmaster=obj.state.host+':'+port;var token=obj.state.token;var data=connect(playmaster,token);obj.setState({socket:data['socket'],status:data['status']});console.log(data['socket']);setListeners(obj);}function stringsToClasses(squares){var classes=[];if(squares){for(var i=0;i<squares.length;i++){var splitter=squares[i].toString().split(\" \");switch(splitter[0]){case\"King\":classes.push(new King(parseInt(splitter[1])));break;case\"Pawn\":classes.push(new Pawn(parseInt(splitter[1])));break;case\"Queen\":classes.push(new Queen(parseInt(splitter[1])));break;case\"Bishop\":classes.push(new Bishop(parseInt(splitter[1])));break;case\"Knight\":classes.push(new Knight(parseInt(splitter[1])));break;case\"Rook\":classes.push(new Rook(parseInt(splitter[1])));break;default:classes.push(null);}}}return classes;}","map":{"version":3,"sources":["/home/panagiotis/Desktop/ds_project/containers/Website/public_html/games/chess/src/components/multiplayer.js"],"names":["openSocket","Bishop","Knight","Queen","Rook","King","Pawn","getArgumenets","url_string","window","location","url","URL","host","hostname","playmaster","searchParams","get","gamemaster","token","args","connect","server","handShake","query","socket","response","setListeners","obj","state","on","message","setState","connectionStatus","roundID","type","myTurn","myColor","board","console","log","classes","stringsToClasses","squares","whiteFallenSoldiers","blackFallenSoldiers","turn","player","status","kingStatus","endstate","disconnect","xhr","XMLHttpRequest","onload","e","readyState","respone","JSON","parse","responseText","reconnect","game","master","delay","ms","cb","setTimeout","getRndInteger","open","setRequestHeader","send","min","max","Math","floor","random","port","data","i","length","splitter","toString","split","push","parseInt"],"mappings":"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","sourcesContent":["import openSocket from 'socket.io-client';\nimport Bishop from '../pieces/bishop.js';\nimport Knight from '../pieces/knight.js';\nimport Queen from '../pieces/queen.js';\nimport Rook from '../pieces/rook.js';\nimport King from '../pieces/king.js';\nimport Pawn from '../pieces/pawn.js';\n// ==========================================\n// ==> Variables in state <==\n\n//==> host: The domain of the host (localhost)\n//==> gamemaster: the port of gamemaster for client requests\n//==> token: the unique token of the user issued from the Authorization Service\n//==> socket: the socket objet of the client connected to the server\n//==> type: the symbol of the user (X,O or white, black)\n//==> roundID: the ID of the game\n\n//==> connectionStatus: Connection Status\n  // -3 => unauthorized user\n  // -2 => trying to reconnect\n  // -1 => no connection (the client has not connect to the giver Playmaster)\n  //  0 => connected\n  //  1 => wait opponent to connect\n  //  2 => ready to play\n  //  3 => the game is completed\n  //  4 => winner because opponent left\n  //  5 => spectator mode\n\n\n// ==========================================\n// ==> Messages from client to playmaster <==\n\n// 1. Send the new board \n\n// let message = {\n//   roundID : this.state.roundID,\n//   board : squares\n// }\n// this.state.socket.emit('update', message)\n\n\n// 2. Inform the playmaster for the winner, if you are the last to play\n\n// let message = {\n//   roundID : this.state.roundID,\n//   winner: winnerInfo,  //0 for tie, 1 if you won, -1 if you lost\n// }\n// this.state.socket.emit('endgame', message)\n\n// ==========================================\n\n// ===> FOR OTHER GAME CHANGE THE LINE 109 and 133-140\n// ==========================================\n\n\n//Get argument from the URL\nexport function getArgumenets() {\n\tlet url_string = window.location['href'];\n  \tlet url = new URL(url_string);\n\n  \tlet host = url.hostname;\n  \tlet playmaster = url.searchParams.get(\"pm\");\n  \tlet gamemaster = url.searchParams.get(\"gm\");\n  \tlet token = url.searchParams.get(\"token\");\n\n  \tlet args = {\n  \t\t'host': host,\n  \t\t'token': token,\n  \t\t'playmaster' : playmaster,\n  \t\t'gamemaster' : gamemaster,\n  \t};\n\n  \treturn args;\n}\n\n\n//Connect to Playmaster\nexport function connect(server, token){\n\n    let handShake = {\n    \tquery:'token='+token\n    }\n\n    let socket = openSocket(server, handShake)\n\n    let response = {\n    \t'socket': socket,\n    \t'connectionStatus': socket['connected'] ? 0 : -1,\n    }\n\n    return response;\n}\n\n\nexport function setListeners(obj){\n\n  //You connected first, wait for the opponent to connect\n  obj.state.socket.on('wait', message => {\n    obj.setState({\n        connectionStatus: 1,\n        roundID: message['roundID'],\n      })\n  });\n\n\n\n  //Both players are connected. The game can begin\n  obj.state.socket.on('init', message => {\n\n    //Check if the game is new or it is continued from server fault.\n    if (obj.state.type === null){\n      obj.setState({\n        connectionStatus: 2,\n        myTurn: message['turn'],\n        roundID: message['roundID'],\n        myColor: message['turn'] ? 'white' : 'black',\n      })\n    }else{\n      obj.setState({\n        connectionStatus: 2,\n        roundID: message['roundID']   //get the new round ID\n      })\n    }\n  });\n\n  //Both players are connected. The game can begin\n  obj.state.socket.on('viewer', board => {\n    console.log('VIWER')\n    var classes = stringsToClasses(board);\n    \n    obj.setState({\n      connectionStatus: 5,\n      squares: classes,\n      myTurn: false\n    })\n  });\n\n\n  //Receive the updated board\n  obj.state.socket.on('board', board => {\n    var classes = stringsToClasses(board[\"board\"]);\n    var whiteFallenSoldiers = stringsToClasses(board[\"whiteFallenSoldiers\"]);\n    var blackFallenSoldiers = stringsToClasses(board[\"blackFallenSoldiers\"]);\n    var turn, player;\n    if (!board['dontChange']){\n      turn = obj.state.turn === 'white'? 'black' : 'white';\n      player = obj.state.player === 1? 2: 1;\n    }else{\n      turn = obj.state.turn;\n      player = obj.state.player;\n    }\n    console.log(board[\"board\"]);\n    console.log(classes);\n      obj.setState({\n        squares: classes,\n        turn: turn,\n        whiteFallenSoldiers: whiteFallenSoldiers,\n        blackFallenSoldiers: blackFallenSoldiers,\n        status: board['status'],\n        kingStatus: board['kingStatus'],\n        player: player,\n        myTurn: true,\n      })\n\n      //Set Game progress\n      if (board['progress']===1) {\n        obj.setState({\n          connectionStatus: 3,\n          endstate: 1\n        })\n      }else if (board['progress']===2){\n        obj.setState({\n          connectionStatus: 3,\n          endstate: 2,\n        })\n\n      }\n  }); \n\n\n  //Handler for server disconnection\n  obj.state.socket.on('disconnect', board => {\n\n    //if you never connected or the game is completed, return\n    if (obj.state.connectionStatus < 0 || obj.state.connectionStatus > 2) {\n      return;\n    }\n\n    obj.state.socket.disconnect()\n\n    obj.setState({\n      connectionStatus: -2,\n    })\n    \n    //Create a request to GameMaster\n    var xhr = new XMLHttpRequest()\n\n    xhr.onload = function (e) {\n\n      if (xhr.readyState === 4) {\n\n        //Check if the GameMaster accepted the request\n        if (xhr.connectionStatus === 200) {  \n          let respone = JSON.parse(xhr.responseText);\n          reconnect(obj, respone['playmaster']);\n        }else if(xhr.connectionStatus === 403){\n          obj.setState({\n            connectionStatus: -3,\n            endstate: 1,\n          })\n        }\n      }\n    }\n\n    let game = 'chess';\n    let master = obj.state.host + ':' + obj.state.gamemaster+'/client';\n    let url = 'http://'+master+'?'+'token='+obj.state.token+'&game='+game+'&roundID='+ obj.state.roundID;\n    \n    const delay = (ms, cb) => setTimeout(cb, ms);\n    \n    delay(getRndInteger(1,300)*100, () => {\n      xhr.open('GET', url);\n      xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\n      xhr.send();\n    })\n  }); \n\n  //The game is over from the server's side\n  obj.state.socket.on('endgame', message => {\n      obj.setState({\n        connectionStatus: 4,\n      })\n      obj.state.socket.disconnect();\n  }); \n\n}\n\nfunction getRndInteger(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n\n//Establish a new connections\nexport function reconnect(obj, port){\n  console.log('reconnecting...')\n  let playmaster = obj.state.host + ':' + port;\n  let token = obj.state.token;\n  var data = connect(playmaster,token)\n\n  obj.setState({\n    socket: data['socket'],\n    status: data['status'],\n  });\n\n  console.log(data['socket']);\n  setListeners(obj);\n}\n\nfunction stringsToClasses(squares){\n  var classes = [];\n\n  if (squares){\n    for (let i=0; i<squares.length; i++){\n      let splitter = squares[i].toString().split(\" \");\n\n      switch(splitter[0]){\n        case \"King\":\n          classes.push(new King(parseInt(splitter[1])));\n          break;\n        case \"Pawn\":\n          classes.push(new Pawn(parseInt(splitter[1])));\n          break;\n        case \"Queen\":\n          classes.push(new Queen(parseInt(splitter[1])));\n          break;\n        case \"Bishop\":\n          classes.push(new Bishop(parseInt(splitter[1])));\n          break;\n        case \"Knight\":\n          classes.push(new Knight(parseInt(splitter[1])));\n          break;\n        case \"Rook\":\n          classes.push(new Rook(parseInt(splitter[1])));\n          break;\n        default:\n          classes.push(null);\n      }\n    }\n  }\n  \n  return classes;\n}"]},"metadata":{},"sourceType":"module"}